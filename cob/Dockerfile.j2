### THIS FILE IS AUTOMATICALLY GENERATED BY COB
### DO NOT EDIT THIS FILE DIRECTLY

FROM {{deployment_base_image}}

ENV PYTHON_VERSION {{python_version}}
ENV PYTHON_EXECUTABLE python$PYTHON_VERSION

ENV LC_ALL C.UTF-8
ENV LANG C.UTF-8

RUN apt-get update
RUN apt-get -y install build-essential rsync software-properties-common libpq-dev nginx curl redis-server gcc sudo libsasl2-dev libldap2-dev wget git


# nginx
RUN add-apt-repository ppa:chris-lea/nginx-devel
RUN apt-get update
RUN apt-get -y install nginx


RUN curl -sL https://deb.nodesource.com/setup_6.x | bash -
RUN apt-get -y install nodejs
RUN npm --version

RUN add-apt-repository ppa:fkrull/deadsnakes
RUN apt-get update
RUN apt-get install -y $PYTHON_EXECUTABLE $PYTHON_EXECUTABLE-dev

RUN wget https://bootstrap.pypa.io/get-pip.py -O /tmp/get-pip.py
RUN $PYTHON_EXECUTABLE /tmp/get-pip.py
RUN $PYTHON_EXECUTABLE -m pip install -U virtualenv pip setuptools

ADD . /app

{% if is_develop %}
RUN $PYTHON_EXECUTABLE -m pip install /app/{{cob_sdist_filename}}
env COB_DEVELOP=1
{% else %}
RUN $PYTHON_EXECUTABLE -m pip install cob
{% endif %}

WORKDIR /app
RUN cob -vvv bootstrap

{{user_steps}}
